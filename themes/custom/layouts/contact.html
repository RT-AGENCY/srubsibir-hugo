{{ define "main" }}
<div class="page-header">
  <div class="container">
    <h1>{{ .Title }}</h1>
  </div>
</div>

<section class="contact-section">
  <div class="container">
    <div class="contact-grid">
      <div class="contact-info">
        <h2>–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏</h2>

        <div class="contact-item">
          <h3>üìû –¢–µ–ª–µ—Ñ–æ–Ω</h3>
          <p><a href="tel:{{ .Site.Params.phone }}">{{ .Site.Params.phone }}</a></p>
          <p>–ë–µ—Å–ø–ª–∞—Ç–Ω–æ –ø–æ –†–æ—Å—Å–∏–∏</p>
        </div>

        <div class="contact-item">
          <h3>‚úâÔ∏è Email</h3>
          <p><a href="mailto:{{ .Site.Params.email }}">{{ .Site.Params.email }}</a></p>
        </div>

        <div class="contact-item">
          <h3>üìç –ê–¥—Ä–µ—Å</h3>
          <p>{{ .Site.Params.address }}</p>
        </div>

        <div class="contact-item">
          <h3>üïí –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</h3>
          <p>–ü–Ω-–ü—Ç: 9:00 - 18:00</p>
          <p>–°–±-–í—Å: 10:00 - 16:00</p>
        </div>
      </div>

      <div class="contact-form-wrapper">
        <h2>–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º</h2>
        <form class="contact-form" id="contactForm">
          <div class="form-group">
            <label for="name">–ò–º—è *</label>
            <input type="text" id="name" name="name" required>
          </div>

          <div class="form-group">
            <label for="email">Email *</label>
            <input type="email" id="email" name="email" required>
          </div>

          <div class="form-group">
            <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input type="tel" id="phone" name="phone">
          </div>

          <div class="form-group">
            <label for="subject">–¢–µ–º–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è</label>
            <select id="subject" name="subject">
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É</option>
              <option value="consultation">–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</option>
              <option value="estimate">–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏</option>
              <option value="cooperation">–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ</option>
              <option value="complaint">–ñ–∞–ª–æ–±–∞</option>
              <option value="other">–î—Ä—É–≥–æ–µ</option>
            </select>
          </div>

          <div class="form-group">
            <label for="message">–°–æ–æ–±—â–µ–Ω–∏–µ *</label>
            <textarea id="message" name="message" rows="5" required
              placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ..."></textarea>
          </div>

          <div class="form-group checkbox-group">
            <input type="checkbox" id="privacy" name="privacy" required>
            <label for="privacy">–Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å <a href="/privacy/" target="_blank">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
              *</label>
          </div>

          <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
        </form>
      </div>
    </div>
  </div>
</section>

<section class="map-section">
  <div class="container">
    <h2>–ö–∞–∫ –Ω–∞—Å –Ω–∞–π—Ç–∏</h2>
    <div class="map-wrapper">
      <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–∞—Ä—Ç–∞ Google Maps –∏–ª–∏ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã -->
      <div id="map" class="map-placeholder">
        <p>–ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</p>
        <!-- –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ iframe —Å –∫–∞—Ä—Ç–æ–π –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ API -->
      </div>
    </div>
  </div>
</section>

{{ .Content }}

<style>
  .contact-section {
    padding: var(--spacing-xxl) 0;
  }

  .contact-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-xxl);
    align-items: start;
  }

  .contact-info h2,
  .contact-form-wrapper h2 {
    margin-bottom: var(--spacing-lg);
    color: var(--color-primary);
  }

  .contact-item {
    margin-bottom: var(--spacing-lg);
    padding: var(--spacing-md);
    background: var(--color-light);
    border-radius: var(--radius-md);
  }

  .contact-item h3 {
    margin-bottom: var(--spacing-sm);
    color: var(--color-text);
    font-size: 1.1rem;
  }

  .contact-item p {
    margin-bottom: var(--spacing-xs);
    color: var(--color-text-light);
  }

  .contact-item a {
    color: var(--color-primary);
    font-weight: 500;
  }

  .contact-item a:hover {
    color: var(--color-secondary);
  }

  .contact-form-wrapper {
    background: var(--color-white);
    padding: var(--spacing-lg);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-md);
  }

  .form-group {
    margin-bottom: var(--spacing-md);
  }

  .form-group label {
    display: block;
    margin-bottom: var(--spacing-xs);
    font-weight: 500;
    color: var(--color-text);
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    font-size: 1rem;
    transition: var(--transition);
    background: var(--color-white);
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(44, 85, 48, 0.1);
  }

  .checkbox-group {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-xs);
  }

  .checkbox-group input[type="checkbox"] {
    width: auto;
    margin-top: 2px;
  }

  .checkbox-group label {
    margin-bottom: 0;
    font-size: 0.9rem;
    line-height: 1.4;
  }

  .checkbox-group a {
    color: var(--color-primary);
  }

  .checkbox-group a:hover {
    text-decoration: underline;
  }

  .map-section {
    padding: var(--spacing-xxl) 0;
    background: var(--color-light);
  }

  .map-section h2 {
    text-align: center;
    margin-bottom: var(--spacing-lg);
  }

  .map-wrapper {
    border-radius: var(--radius-md);
    overflow: hidden;
    box-shadow: var(--shadow-md);
  }

  .map-placeholder {
    height: 400px;
    background: var(--color-border);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-text-muted);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .contact-grid {
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
    }

    .contact-form-wrapper {
      padding: var(--spacing-md);
    }

    .checkbox-group {
      align-items: center;
    }
  }

  /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —Ñ–æ—Ä–º—ã */
  .form-group input:invalid,
  .form-group textarea:invalid {
    border-color: var(--color-danger, #dc3545);
  }

  .form-group input:valid,
  .form-group textarea:valid {
    border-color: var(--color-success, #28a745);
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ */
  .contact-form.loading {
    opacity: 0.7;
    pointer-events: none;
  }

  .contact-form.loading .btn {
    position: relative;
  }

  .contact-form.loading .btn::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid transparent;
    border-top: 2px solid var(--color-white);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }

    100% {
      transform: rotate(360deg);
    }
  }
</style>

<script>
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
  document.addEventListener('DOMContentLoaded', function () {
    const contactForm = document.getElementById('contactForm');

    if (contactForm) {
      // –ú–∞—Å–∫–∞ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      const phoneInput = document.getElementById('phone');
      if (phoneInput) {
        phoneInput.addEventListener('input', function (e) {
          let value = e.target.value.replace(/\D/g, '');
          if (value.length > 0) {
            if (value[0] === '8') {
              value = '7' + value.slice(1);
            }
            if (value[0] === '7') {
              value = value.replace(/^7(\d{3})(\d{3})(\d{2})(\d{2})$/, '+7 ($1) $2-$3-$4');
            }
          }
          e.target.value = value;
        });
      }

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
      contactForm.addEventListener('submit', function (e) {
        e.preventDefault();

        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
        contactForm.classList.add('loading');

        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
        const formData = new FormData(contactForm);
        const data = Object.fromEntries(formData.entries());

        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (validateContactForm(data)) {
          // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à—É –ª–æ–≥–∏–∫—É)
          submitContactForm(data).then(() => {
            // –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
            window.SrubSibir.showNotification('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.', 'success');
            contactForm.reset();
          }).catch(() => {
            // –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
            window.SrubSibir.showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'error');
          }).finally(() => {
            // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
            contactForm.classList.remove('loading');
          });
        } else {
          contactForm.classList.remove('loading');
        }
      });
    }
  });

  function validateContactForm(data) {
    const errors = [];

    if (!data.name || data.name.trim().length < 2) {
      errors.push('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è');
    }

    if (!data.email || !data.email.includes('@')) {
      errors.push('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email');
    }

    if (!data.message || data.message.trim().length < 10) {
      errors.push('–°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤');
    }

    if (!data.privacy) {
      errors.push('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
    }

    if (errors.length > 0) {
      window.SrubSibir.showNotification('–û—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–µ: ' + errors.join(', '), 'error');
      return false;
    }

    return true;
  }

  async function submitContactForm(data) {
    // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∞—à–∞ –ª–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    // –ù–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ fetch API –∏–ª–∏ –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–±

    return new Promise((resolve, reject) => {
      // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏
      setTimeout(() => {
        console.log('–î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã:', data);
        resolve();
      }, 2000);
    });
  }
</script>
{{ end }}